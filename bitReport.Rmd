---
title: "bitReport"
description: |
  네이버 오픈 API를 이용한 데이터 수집 로직을 구현해 봅니다.  
author:
  - name: 유충현
    url: https://choonghyunryu.github.io
    affiliation: 한국R사용자회
citation_url: https://choonghyunryu.github.io/tidyverse-meets-shiny/open_api
date: 2023-06-24
output:
  distill::distill_article:
    self_contained: false  
    toc: true
    toc_depth: 3    
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      message = FALSE, 
                      warning = FALSE, 
                      collapse = FALSE,
                      fig.align = "center")
library(shiny)
library(htmltools)

xaringanExtra::use_panelset()
```

```{r naver, echo=FALSE, out.width = "20%"}
knitr::include_graphics("https://raw.githubusercontent.com/bit2r/bitReport/main/man/figures/bitReport_logo.png")
```

```{r, preface, echo=FALSE}
div(class = "preface", 
    h4("들어가기"),
    "공유 목적으로 배포할 ", strong("데이터분석 보고서의 핵심은 인사이트의 제공"), "에 있습니다.", br(),
    "그러나 인사이트 발굴을 위한 분석가의 노력과 더불어 보고서 서식을 만들고, 시각화 결과를 옮겨서 ", 
    strong("문서를 편집하는 일련의 작업들에도 많은 리소스가 소비"), "됩니다.", br(),
    "이와 같은 ", strong("휴먼 리소스의 소비를 줄이고자 보고서 (반)자동화 방법을 제시"), "합니다.")
```

## 무엇이 문제인가?

- Markdown이라는 훌륭한 조판/저작 도구가 있으나 활용하지 않는다.
    - 파워포인트 편집 중심
    - 분석 결과는 파워포인트로 탄생하지만,
        - 과정에서의 정보는 개인의 암묵적 지식으로 남고,
        - 개인과 조직의 자산으로 남지 않는다.
- 재현성의 부재
    - Reproducible Research 기반의 저작이 이루어지지 않음
        - 파워포인트로의 편집시에 코딩 오류가 발생할 수 있음
        - 버전관리 이슈로 보고서의 결과가 관리되는 스크립트의 결과가 아닌 엉뚱한 결과로 배포될 수 있음
- 노동 집약적인 서식작업/편집작업
    - 결과를 복사하거나, 플롯을 복사해서 파워포인트에 붙여넣음
        - 수작업의 자동화로 분석 결과의 코딩오류를 줄이고,
        - 단순 작업을 자동화로 대체하여 리소스를 절약할 필요가 있음

## bitReport 기능과 특징

### 기능

- 정적 리포트 작성
    - 세로방향 PDF 페이지 문서 생성
    - 웹 페이지 생성
- 동적 리포트 작성
    - 웹 대시보드 생성
    - 웹 슬라이드 문서 생성

### 특징

- 보고서 템플리트 제공
    - RStudio의 메뉴로 제공
    - 템플리트를 수정해서 보고서 생성
- 시각화 및 도표 출력 템플리트 함수 제공
    - 템플리트 함수를 이용하거나 수정해서 보고서에 삽입할 도표나 플롯 출력
- 한글 폰트 포함
    - NanumSquare 폰트
- 웹 페이지를 스크린샷 할수 있는 프로그램 포함
    - webshot 패키지를 이용한 스크린 샷


## 사용방법

### 정적 리포트 작성

#### 세로방향 PDF 페이지 문서 생성

다음과 같은 두 가지의 API가 있습니다. 여기서는 출력 포맷이 XML인 API를 이용합니다.

+--------+------+-------------------------------------------------+---------------+
| 메서드 | 인증 | 요청 URL                                        | **출력 포맷** |
+========+======+=================================================+===============+
| GET    | \-   | <https://openapi.naver.com/v1/search/news.xml>  | XML           |
+--------+------+-------------------------------------------------+---------------+
| GET    | \-   | <https://openapi.naver.com/v1/search/news.json> | *JSON*        |
+--------+------+-------------------------------------------------+---------------+

### 요청 변수 (request parameter)

+---------------+----------+--------------+-----------------------+------------------------------------------+
| **요청 변수** | **타입** | **필수여부** | **기본값**            | **설명**                                 |
+===============+==========+==============+=======================+==========================================+
| query         | string   | Y            | \-                    | 검색을 원하는 문자열로서 UTF-8로 인코딩  |
+---------------+----------+--------------+-----------------------+------------------------------------------+
| display       | integer  | N            | 10(기본값), 100(최대) | 검색 결과 출력 건수 지정                 |
+---------------+----------+--------------+-----------------------+------------------------------------------+
| start         | integer  | N            | 1(기본값), 1000(최대) | 검색 시작 위치로 최대 1000까지 가능      |
+---------------+----------+--------------+-----------------------+------------------------------------------+
| sort          | string   | N            | sim, date(기본값)     | 정렬 옵션: sim (유사도순), date (날짜순) |
+---------------+----------+--------------+-----------------------+------------------------------------------+

### 출력 결과

+---------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **필드**      | **타입** | **설명**                                                                                                                                                     |
+:=============:+:========:+==============================================================================================================================================================+
| rss           | \-       | 디버그를 쉽게 하고 RSS 리더기만으로 이용할 수 있게 하기 위해 만든 RSS 포맷의 컨테이너이며 그 외의 특별한 의미는 없다.                                        |
+---------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
| channel       | \-       | 검색 결과를 포함하는 컨테이너이다. 이 안에 있는 title, link, description 등의 항목은 참고용으로 무시해도 무방하다.                                           |
+---------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
| lastBuildDate | datetime | 검색 결과를 생성한 시간이다.                                                                                                                                 |
+---------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
| total         | integer  | 검색 결과 문서의 총 개수를 의미한다.                                                                                                                         |
+---------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
| start         | integer  | 검색 결과 문서 중, 문서의 시작점을 의미한다.                                                                                                                 |
+---------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
| display       | integer  | 검색된 검색 결과의 개수이다.                                                                                                                                 |
+---------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
| item/items    | \-       | XML 포멧에서는 item 태그로, JSON 포멧에서는 items 속성으로 표현된다. 개별 검색 결과이며 title, originallink, link, description, pubDate를 포함한다.          |
+---------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
| title         | string   | 개별 검색 결과이며, title, originallink, link, description, pubDate 를 포함한다.                                                                             |
+---------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
| originallink  | string   | 검색 결과 문서의 제공 언론사 하이퍼텍스트 link를 나타낸다.                                                                                                   |
+---------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
| link          | string   | 검색 결과 문서의 제공 네이버 하이퍼텍스트 link를 나타낸다.                                                                                                   |
+---------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
| description   | string   | 검색 결과 문서의 내용을 요약한 패시지 정보이다. 문서 전체의 내용은 link를 따라가면 읽을 수 있다. 패시지에서 검색어와 일치하는 부분은 **태그로 감싸져 있다.** |
+---------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
| pubDate       | datetime | 검색 결과 문서가 네이버에 제공된 시간이다.                                                                                                                   |
+---------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+

### 준비사항

-   애플리케이션 등록: 네이버 오픈 API로 개발하시려면 먼저 ['Application-애플리케이션 등록'](https://developers.naver.com/apps/#/register?defaultScope=search){target="_blank"} 메뉴에서 애플리케이션을 등록하셔야 합니다.

```{r lint, fig.align='center', fig.pos='h', echo=FALSE, out.width = '100%', fig.cap="애플리케이션 등록 (API 이용신청) 화면"}
knitr::include_graphics('https://r2bit.com/bitGPT/reference/figures/gogh_01.png', dpi = 300)
```


```{r, caution-1, echo=FALSE}
div(class = "bg-orange", 
    h4(icon("exclamation-circle", style = "margin-right: 5px;"), 
       "주의", style = "margin-bottom: 10px; margin-top: 0px;"), 
    "클라이언트 아이디(Client ID)와  클라이언트 보안키(Client Secret)는 개인 사용자에게 발급된 정보이므로 반드시 보안에 주의해야 합니다. 타인에게 공개 및 공유하면 안된 중요한 정보이므로 사용에 주의해야 합니다.")
```

## 네이버 뉴스 검색 프로그램 개발

### 요청 URL 생성

XML 출력 포맷을 사용하기 때문에 다음 요청 URL을 사용합니다.

-   <https://openapi.naver.com/v1/search/news.xml>

검색 질의어인 **query는 UTF-8로 인코딩**해야 하기 때문에 **enc2utf8()**와 **URLencode()**을 사용합니다. GET 방식의 호출 URL이기 때문에 요청변수 영역을 **?**로 구분하고, 요청 변수들은 **&**로 구분합니다.

```{r, eval=FALSE}
  searchUrl <- "https://openapi.naver.com/v1/search/news.xml"

  query <- query %>%
    enc2utf8() %>%
    URLencode()

  url <- glue::glue("{searchUrl}?query={query}&display={chunk}&start={chunk_no}&sort={sort}")
```



```{r, caution-2, echo=FALSE}
div(class = "bg-orange", 
    h4(icon("exclamation-circle", style = "margin-right: 5px;"), 
       "주의", style = "margin-bottom: 10px; margin-top: 0px;"), 
    "R은 눈사람을 만드는 것처럼 데이터를 키워나가면 안됩니다.", br(),
    "rbind() 함수를 이용해서 API를 순차적으로 호출하면서 데이터 프레임에 결과를 붙여나가면 안됩니다. R 데이터 프레임에 관측치를 붙여나가면서 데이터를 크게 불리는 작업은 치명적인 성능 감소를 가져옵니다.")
```
